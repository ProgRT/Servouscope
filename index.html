<!DOCTYPE html>
<meta charset='UTF-8' />
<title>Servouscope</title>

<link rel="icon" type="image/png" href="logo.svg.png" />
<link rel="stylesheet" href="css/app2.css" />

<template id='logo'>
	<div>
		<h1>
			<img src="logo.svg"/>
			Servouscope
		</h1>
		<p class="subtitle">
		Visualisateur pour données exportées du ventilateur Servo-u.
		</p>
	</div>
</template>

<script src="./lib/d3.v3.min.js"></script>
<script type="module">
	import {sudev} from './mod/sudev.js';
    import {parseDataset} from './mod/dataset.js';

    let params = new URLSearchParams(window.location.search);
    window.params = params;
    const dv = {
        name: 'Delta volume',
        unit: 'ml',
        f: (a, d, i , t) => a + (d.DÉBIT/6),
        round: true
    };

    const conf = {
		multiple: true, 
        //displayStyle: 'aDisplay',
		dParams: {
            availableNumParams: [],
			zoomable: params.has('zoomable'),
			reducers: [dv],
            units: null
		}
	};

	const disp = new sudev('body', conf);

    if(params.has('demo')){
        fetch('data/1546250546580.txt')
            .then(responce=>responce.text())
            .then(text => {
                let ds = parseDataset(text);
                console.log(ds.data[0]);

                disp.display.display(ds.data.map(d=>{
                    d.time = d.Time;
                    return d;
                }));
                disp.pDisplay.display(ds);
                disp.target.classList.remove('landing');
                disp.display.redraw();
            }
            );
    }
</script>
